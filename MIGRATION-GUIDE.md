# è¿ç§»æŒ‡å—ï¼šä» AngularJS åˆ° React

è¿™ä¸ªæ–‡æ¡£è¯¦ç»†è¯´æ˜äº†å¦‚ä½•ä»åŸæœ‰çš„ AngularJS ç‰ˆæœ¬è¿ç§»åˆ°æ–°çš„ React ç‰ˆæœ¬ã€‚

## ğŸ”„ è¿ç§»æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šå¤‡ä»½ç°æœ‰æ’ä»¶

```bash
# å¤‡ä»½å½“å‰ç‰ˆæœ¬
cp -r /var/lib/grafana/plugins/grafana-meta-queries /var/lib/grafana/plugins/grafana-meta-queries-backup
```

### ç¬¬äºŒæ­¥ï¼šå®‰è£…æ–°ç‰ˆæœ¬

1. **å…‹éš†æˆ–æ›´æ–°ä»“åº“**ï¼š
```bash
git pull origin master
```

2. **å®‰è£… React ç‰ˆæœ¬ä¾èµ–**ï¼š
```bash
# ä½¿ç”¨æ–°çš„ package.json
cp package-react.json package.json
npm install
```

3. **æ„å»º React ç‰ˆæœ¬**ï¼š
```bash
npm run build
```

4. **éƒ¨ç½²åˆ° Grafana**ï¼š
```bash
# ä½¿ç”¨ src-react ä½œä¸ºæºä»£ç ç›®å½•
cp -r dist /var/lib/grafana/plugins/grafana-meta-queries-react
```

### ç¬¬ä¸‰æ­¥ï¼šæ›´æ–°æ•°æ®æºé…ç½®

1. åœ¨ Grafana ä¸­åˆ›å»ºæ–°çš„æ•°æ®æºå®ä¾‹
2. é€‰æ‹© "MetaQueries (React)" ä½œä¸ºæ•°æ®æºç±»å‹
3. æµ‹è¯•è¿æ¥ç¡®ä¿å·¥ä½œæ­£å¸¸

### ç¬¬å››æ­¥ï¼šè¿ç§»ç°æœ‰é¢æ¿

1. **å¯¼å‡ºç°æœ‰ä»ªè¡¨æ¿**ï¼šåœ¨ Grafana ä¸­å¯¼å‡ºä½¿ç”¨ Meta Queries çš„ä»ªè¡¨æ¿
2. **ç¼–è¾‘ä»ªè¡¨æ¿ JSON**ï¼šå°†æ•°æ®æºå¼•ç”¨ä»æ—§ç‰ˆæœ¬æ›´æ”¹ä¸ºæ–°ç‰ˆæœ¬
3. **é‡æ–°å¯¼å…¥ä»ªè¡¨æ¿**ï¼šå¯¼å…¥ä¿®æ”¹åçš„ä»ªè¡¨æ¿

## ğŸ“Š ç•Œé¢å¯¹æ¯”

### AngularJS ç‰ˆæœ¬ vs React ç‰ˆæœ¬

| åŠŸèƒ½ | AngularJS ç‰ˆæœ¬ | React ç‰ˆæœ¬ | æ”¹è¿›ç‚¹ |
|------|---------------|------------|-------|
| æŸ¥è¯¢ç±»å‹é€‰æ‹© | ä¸‹æ‹‰èœå• | ä¸‹æ‹‰èœå• + æè¿° | å¢åŠ äº†åŠŸèƒ½æè¿° |
| è¾“å…¥éªŒè¯ | åŸºç¡€éªŒè¯ | å®æ—¶éªŒè¯ + é”™è¯¯æç¤º | æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ |
| ç•Œé¢å¸ƒå±€ | å›ºå®šå¸ƒå±€ | å“åº”å¼å¸ƒå±€ | é€‚é…ä¸åŒå±å¹• |
| é”™è¯¯æ˜¾ç¤º | è­¦å‘Šå›¾æ ‡ | è­¦å‘Šé¢æ¿ + è¯¦ç»†ä¿¡æ¯ | æ›´æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯ |
| å­—æ®µæç¤º | åŸºç¡€æç¤º | å·¥å…·æç¤º + å¸®åŠ©æ–‡æœ¬ | æ›´è¯¦ç»†çš„æŒ‡å¯¼ |

### æŸ¥è¯¢ç¼–è¾‘å™¨åŠŸèƒ½å¯¹æ¯”

#### TimeShift æŸ¥è¯¢
**åŸç‰ˆæœ¬**ï¼š
- åŸºç¡€çš„å‘¨æœŸå’Œå•ä½é€‰æ‹©
- ç®€å•çš„æŸ¥è¯¢å’ŒæŒ‡æ ‡è¾“å…¥

**React ç‰ˆæœ¬**ï¼š
- å®æ—¶éªŒè¯å‘¨æœŸæ•°å€¼
- æ¸…æ™°çš„å•ä½é€‰æ‹©
- æ™ºèƒ½æç¤ºå’Œå¸®åŠ©æ–‡æœ¬
- åŠ¨æ€æ˜¾ç¤ºæŸ¥è¯¢æè¿°

#### MovingAverage æŸ¥è¯¢
**åŸç‰ˆæœ¬**ï¼š
- å‘¨æœŸè¾“å…¥
- æŸ¥è¯¢å’ŒæŒ‡æ ‡å­—æ®µ

**React ç‰ˆæœ¬**ï¼š
- æ•°å€¼éªŒè¯ï¼ˆæœ€å°å€¼ä¸º1ï¼‰
- æ¸…æ™°çš„å­—æ®µè¯´æ˜
- å®æ—¶é”™è¯¯æç¤º

#### Arithmetic æŸ¥è¯¢
**åŸç‰ˆæœ¬**ï¼š
- è¡¨è¾¾å¼è¾“å…¥æ¡†

**React ç‰ˆæœ¬**ï¼š
- è¡¨è¾¾å¼éªŒè¯
- æŸ¥è¯¢å¼•ç”¨è¯´æ˜ï¼ˆA, B, Cç­‰ï¼‰
- è¡¨è¾¾å¼ç¤ºä¾‹å’Œå¸®åŠ©

## ğŸ”§ é…ç½®å·®å¼‚

### plugin.json å˜åŒ–

```json
// åŸç‰ˆæœ¬
{
  "dependencies": {
    "grafanaDependency": ">=4.0.0"
  }
}

// React ç‰ˆæœ¬
{
  "dependencies": {
    "grafanaDependency": ">=8.0.0"
  }
}
```

### æ„å»ºç³»ç»Ÿå˜åŒ–

| åŸç‰ˆæœ¬ | React ç‰ˆæœ¬ |
|--------|------------|
| Grunt | Grafana Toolkit |
| TypeScript 1.7 | TypeScript 5.0 |
| æ‰‹åŠ¨æ¨¡å—ç®¡ç† | ES6 æ¨¡å— |

## âš ï¸ æ³¨æ„äº‹é¡¹

### å…¼å®¹æ€§

1. **Grafana ç‰ˆæœ¬è¦æ±‚**ï¼šReact ç‰ˆæœ¬éœ€è¦ Grafana >= 8.0.0
2. **æŸ¥è¯¢æ ¼å¼å…¼å®¹**ï¼šæŸ¥è¯¢æ ¼å¼ä¿æŒ100%å…¼å®¹ï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰æŸ¥è¯¢
3. **æ•°æ®æºé…ç½®**ï¼šé…ç½®å‚æ•°ä¿æŒä¸€è‡´

### å·²çŸ¥å·®å¼‚

1. **UIç»„ä»¶åº“**ï¼šä»è‡ªå®šä¹‰CSSæ”¹ä¸º @grafana/ui ç»„ä»¶
2. **éªŒè¯è¡Œä¸º**ï¼šReactç‰ˆæœ¬æä¾›æ›´å®æ—¶çš„éªŒè¯åé¦ˆ
3. **é”™è¯¯æ˜¾ç¤º**ï¼šé”™è¯¯ä¿¡æ¯æ˜¾ç¤ºæ–¹å¼æœ‰æ‰€æ”¹å–„

## ğŸ§ª æµ‹è¯•éªŒè¯

### åŠŸèƒ½æµ‹è¯•æ¸…å•

- [ ] TimeShift æŸ¥è¯¢æ­£å¸¸å·¥ä½œ
- [ ] MovingAverage æŸ¥è¯¢æ­£å¸¸å·¥ä½œ  
- [ ] Arithmetic æŸ¥è¯¢æ­£å¸¸å·¥ä½œ
- [ ] è¾“å…¥éªŒè¯æŒ‰é¢„æœŸå·¥ä½œ
- [ ] é”™è¯¯ä¿¡æ¯æ­£ç¡®æ˜¾ç¤º
- [ ] æ•°æ®æºæµ‹è¯•è¿æ¥æˆåŠŸ
- [ ] é¢æ¿æ•°æ®æ­£ç¡®æ˜¾ç¤º

### æµ‹è¯•æ­¥éª¤

1. **åˆ›å»ºæµ‹è¯•æŸ¥è¯¢**ï¼š
```javascript
// TimeShift ç¤ºä¾‹
{
  "queryType": "TimeShift",
  "periods": 7,
  "timeshiftUnit": "days",
  "query": "A",
  "metric": "cpu_usage",
  "outputMetricName": "cpu_usage_7d_ago"
}

// MovingAverage ç¤ºä¾‹
{
  "queryType": "MovingAverage", 
  "periods": 7,
  "query": "A",
  "metric": "cpu_usage",
  "outputMetricName": "cpu_usage_7d_avg"
}

// Arithmetic ç¤ºä¾‹
{
  "queryType": "Arithmetic",
  "expression": "A - B",
  "outputMetricName": "cpu_diff"
}
```

2. **éªŒè¯æ•°æ®è¾“å‡º**ï¼šç¡®ä¿è¾“å‡ºæ•°æ®æ ¼å¼å’Œæ•°å€¼ä¸åŸç‰ˆæœ¬ä¸€è‡´

## ğŸ”™ å›æ»šæ–¹æ¡ˆ

å¦‚æœéœ€è¦å›æ»šåˆ° AngularJS ç‰ˆæœ¬ï¼š

1. **åœæ­¢ Grafana**ï¼š
```bash
sudo systemctl stop grafana-server
```

2. **æ¢å¤åŸç‰ˆæœ¬**ï¼š
```bash
rm -rf /var/lib/grafana/plugins/grafana-meta-queries-react
cp -r /var/lib/grafana/plugins/grafana-meta-queries-backup /var/lib/grafana/plugins/grafana-meta-queries
```

3. **é‡å¯ Grafana**ï¼š
```bash
sudo systemctl start grafana-server
```

## ğŸ“ æ”¯æŒå’Œé—®é¢˜åé¦ˆ

å¦‚æœåœ¨è¿ç§»è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æ£€æŸ¥ Grafana æ—¥å¿—ï¼š`/var/log/grafana/grafana.log`
2. éªŒè¯æ’ä»¶æ˜¯å¦æ­£ç¡®åŠ è½½
3. ç¡®è®¤ä¾èµ–ç‰ˆæœ¬åŒ¹é…è¦æ±‚
4. åœ¨ GitHub ä»“åº“æäº¤ Issue

## ğŸ¯ è¿ç§»åçš„ä¼˜åŠ¿

å®Œæˆè¿ç§»åï¼Œä½ å°†è·å¾—ï¼š

- âœ¨ ç°ä»£åŒ–çš„ç”¨æˆ·ç•Œé¢
- ğŸš€ æ›´å¥½çš„æ€§èƒ½å’Œç¨³å®šæ€§
- ğŸ” å¢å¼ºçš„é”™è¯¯æ£€æµ‹å’ŒéªŒè¯
- ğŸ“± å“åº”å¼è®¾è®¡æ”¯æŒ
- ğŸ› ï¸ æ›´å¥½çš„å¼€å‘å’Œç»´æŠ¤ä½“éªŒ
- ğŸ”® é¢å‘æœªæ¥çš„æŠ€æœ¯æ ˆ
